<script setup lang="ts">
import {inject, onMounted, Ref} from "vue";
import {FormKitIcon} from "@formkit/vue";
import Holder from "@/components/bar/Holder.vue";
import {contrast as customContrast} from "@/helpers/colorHelper.ts";
import {FormSectionType} from "@/types/IForms.ts";

const props = defineProps<{
  selected: boolean
  mainColor: string
}>();

const ignoreTargetClass = inject('ignoreTargetOnSectionClickOutside')
const selectedSection = inject<Ref<FormSectionType>>('selectedSection')

onMounted(() => {
  if (!selectedSection?.value) return
  selectedSection.value.color = props.mainColor
})
</script>

<template>
  <div
      class="custom-border w-full border-2 rounded-lg bg-gray-100 pb-4 relative text-gray-500 overflow-hidden transition"
  >
    <div v-if="selected" :class="ignoreTargetClass"
         class="flex items-center gap-x-2 absolute top-0.5 right-3 h-fit w-fit z-20">
      <label v-if="selectedSection" for="someColorSelector" class="relative">

        <svg class="w-[1.12rem] h-full z-20 stroke-1 custom-text-color cursor-pointer" viewBox="0 0 24 24"
             xmlns="http://www.w3.org/2000/svg">
          <path
              d="M12 22C10.6333 22 9.34167 21.7375 8.125 21.2125C6.90833 20.6875 5.84583 19.9708 4.9375 19.0625C4.02917 18.1542 3.3125 17.0917 2.7875 15.875C2.2625 14.6583 2 13.3667 2 12C2 10.6167 2.27083 9.31667 2.8125 8.1C3.35417 6.88333 4.0875 5.825 5.0125 4.925C5.9375 4.025 7.01667 3.3125 8.25 2.7875C9.48333 2.2625 10.8 2 12.2 2C13.5333 2 14.7917 2.22917 15.975 2.6875C17.1583 3.14583 18.1958 3.77917 19.0875 4.5875C19.9792 5.39583 20.6875 6.35417 21.2125 7.4625C21.7375 8.57083 22 9.76667 22 11.05C22 12.9667 21.4167 14.4375 20.25 15.4625C19.0833 16.4875 17.6667 17 16 17H14.15C14 17 13.8958 17.0417 13.8375 17.125C13.7792 17.2083 13.75 17.3 13.75 17.4C13.75 17.6 13.875 17.8875 14.125 18.2625C14.375 18.6375 14.5 19.0667 14.5 19.55C14.5 20.3833 14.2708 21 13.8125 21.4C13.3542 21.8 12.75 22 12 22ZM6.5 13C6.93333 13 7.29167 12.8583 7.575 12.575C7.85833 12.2917 8 11.9333 8 11.5C8 11.0667 7.85833 10.7083 7.575 10.425C7.29167 10.1417 6.93333 10 6.5 10C6.06667 10 5.70833 10.1417 5.425 10.425C5.14167 10.7083 5 11.0667 5 11.5C5 11.9333 5.14167 12.2917 5.425 12.575C5.70833 12.8583 6.06667 13 6.5 13ZM9.5 9C9.93333 9 10.2917 8.85833 10.575 8.575C10.8583 8.29167 11 7.93333 11 7.5C11 7.06667 10.8583 6.70833 10.575 6.425C10.2917 6.14167 9.93333 6 9.5 6C9.06667 6 8.70833 6.14167 8.425 6.425C8.14167 6.70833 8 7.06667 8 7.5C8 7.93333 8.14167 8.29167 8.425 8.575C8.70833 8.85833 9.06667 9 9.5 9ZM14.5 9C14.9333 9 15.2917 8.85833 15.575 8.575C15.8583 8.29167 16 7.93333 16 7.5C16 7.06667 15.8583 6.70833 15.575 6.425C15.2917 6.14167 14.9333 6 14.5 6C14.0667 6 13.7083 6.14167 13.425 6.425C13.1417 6.70833 13 7.06667 13 7.5C13 7.93333 13.1417 8.29167 13.425 8.575C13.7083 8.85833 14.0667 9 14.5 9ZM17.5 13C17.9333 13 18.2917 12.8583 18.575 12.575C18.8583 12.2917 19 11.9333 19 11.5C19 11.0667 18.8583 10.7083 18.575 10.425C18.2917 10.1417 17.9333 10 17.5 10C17.0667 10 16.7083 10.1417 16.425 10.425C16.1417 10.7083 16 11.0667 16 11.5C16 11.9333 16.1417 12.2917 16.425 12.575C16.7083 12.8583 17.0667 13 17.5 13ZM12 20C12.15 20 12.2708 19.9583 12.3625 19.875C12.4542 19.7917 12.5 19.6833 12.5 19.55C12.5 19.3167 12.375 19.0417 12.125 18.725C11.875 18.4083 11.75 17.9333 11.75 17.3C11.75 16.6 11.9917 16.0417 12.475 15.625C12.9583 15.2083 13.55 15 14.25 15H16C17.1 15 18.0417 14.6792 18.825 14.0375C19.6083 13.3958 20 12.4 20 11.05C20 9.03333 19.2292 7.35417 17.6875 6.0125C16.1458 4.67083 14.3167 4 12.2 4C9.93333 4 8 4.775 6.4 6.325C4.8 7.875 4 9.76667 4 12C4 14.2167 4.77917 16.1042 6.3375 17.6625C7.89583 19.2208 9.78333 20 12 20Z"
          />
        </svg>

        <input v-model="selectedSection.color"
               class="pointer-events-none absolute invisible size-0" type="color"
               id="someColorSelector" />
      </label>

      <svg class="w-4 h-full z-20 stroke-1 custom-text-color cursor-pointer" viewBox="0 0 20 18"
           fill="none" xmlns="http://www.w3.org/2000/svg">
        <path
            d="M15.75 17.25C14.7 17.25 13.8125 16.8875 13.0875 16.1625C12.3625 15.4375 12 14.55 12 13.5C12 12.45 12.3625 11.5625 13.0875 10.8375C13.8125 10.1125 14.7 9.75 15.75 9.75C16.8 9.75 17.6875 10.1125 18.4125 10.8375C19.1375 11.5625 19.5 12.45 19.5 13.5C19.5 14.55 19.1375 15.4375 18.4125 16.1625C17.6875 16.8875 16.8 17.25 15.75 17.25ZM15.75 15.25C16.2333 15.25 16.6458 15.0792 16.9875 14.7375C17.3292 14.3958 17.5 13.9833 17.5 13.5C17.5 13.0167 17.3292 12.6042 16.9875 12.2625C16.6458 11.9208 16.2333 11.75 15.75 11.75C15.2667 11.75 14.8542 11.9208 14.5125 12.2625C14.1708 12.6042 14 13.0167 14 13.5C14 13.9833 14.1708 14.3958 14.5125 14.7375C14.8542 15.0792 15.2667 15.25 15.75 15.25ZM9 14.5H3C2.71667 14.5 2.47917 14.4042 2.2875 14.2125C2.09583 14.0208 2 13.7833 2 13.5C2 13.2167 2.09583 12.9792 2.2875 12.7875C2.47917 12.5958 2.71667 12.5 3 12.5H9C9.28333 12.5 9.52083 12.5958 9.7125 12.7875C9.90417 12.9792 10 13.2167 10 13.5C10 13.7833 9.90417 14.0208 9.7125 14.2125C9.52083 14.4042 9.28333 14.5 9 14.5ZM4.25 8.25C3.2 8.25 2.3125 7.8875 1.5875 7.1625C0.8625 6.4375 0.5 5.55 0.5 4.5C0.5 3.45 0.8625 2.5625 1.5875 1.8375C2.3125 1.1125 3.2 0.75 4.25 0.75C5.3 0.75 6.1875 1.1125 6.9125 1.8375C7.6375 2.5625 8 3.45 8 4.5C8 5.55 7.6375 6.4375 6.9125 7.1625C6.1875 7.8875 5.3 8.25 4.25 8.25ZM4.25 6.25C4.73333 6.25 5.14583 6.07917 5.4875 5.7375C5.82917 5.39583 6 4.98333 6 4.5C6 4.01667 5.82917 3.60417 5.4875 3.2625C5.14583 2.92083 4.73333 2.75 4.25 2.75C3.76667 2.75 3.35417 2.92083 3.0125 3.2625C2.67083 3.60417 2.5 4.01667 2.5 4.5C2.5 4.98333 2.67083 5.39583 3.0125 5.7375C3.35417 6.07917 3.76667 6.25 4.25 6.25ZM17 5.5H11C10.7167 5.5 10.4792 5.40417 10.2875 5.2125C10.0958 5.02083 10 4.78333 10 4.5C10 4.21667 10.0958 3.97917 10.2875 3.7875C10.4792 3.59583 10.7167 3.5 11 3.5H17C17.2833 3.5 17.5208 3.59583 17.7125 3.7875C17.9042 3.97917 18 4.21667 18 4.5C18 4.78333 17.9042 5.02083 17.7125 5.2125C17.5208 5.40417 17.2833 5.5 17 5.5Z"
            fill=""/>
      </svg>


      <FormKitIcon @click="$emit('close')" icon="close"
                   class="flex h-fit w-4 cursor-pointer custom-text-color"
      />

    </div>
    <Transition name="bounce">
      <Holder :icon-color="customContrast(mainColor)" v-if="selected" class="custom-background" hold-class="handler"/>
    </Transition>
    <slot></slot>
  </div>
</template>

<style scoped>
.custom-background {
  background-color: v-bind(mainColor) !important;
}

.custom-border {
  border-color: v-bind(mainColor);
}

.custom-text-color {
  color: v-bind(customContrast(mainColor)) !important;
  fill: v-bind(customContrast(mainColor));
}

.bounce-enter-active {
  animation: bounce-in 0.1s;
}

.bounce-leave-active {
  animation: bounce-in 0.1s reverse;
}

@keyframes bounce-in {
  0% {
    transform: scaleY(0);
    transform-origin: bottom;
  }

  100% {
    transform: scale(1);
  }
}
</style>
